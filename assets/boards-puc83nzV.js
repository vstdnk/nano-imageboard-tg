var l=(d,t,e)=>new Promise((o,s)=>{var a=r=>{try{c(e.next(r))}catch(p){s(p)}},n=r=>{try{c(e.throw(r))}catch(p){s(p)}},c=r=>r.done?o(r.value):Promise.resolve(r.value).then(a,n);c((e=e.apply(d,t)).next())});const i="https://2ch.hk",u=["https://corsproxy.io/?","https://api.allorigins.win/raw?url=","https://cors-anywhere.herokuapp.com/"];class m{static getBoards(){return l(this,null,function*(){for(const t of u)try{const e=t==="https://api.allorigins.win/raw?url="?`${t}${encodeURIComponent(`${i}/api/boards.json`)}`:`${t}${encodeURIComponent(`${i}/api/boards.json`)}`,o=yield fetch(e);if(o.ok){const s=yield o.json();return this.processBoardsData(s)}}catch(e){console.warn(`CORS proxy ${t} failed:`,e);continue}return console.warn("All CORS proxies failed, using fallback data"),this.getFallbackBoards()})}static getFallbackBoards(){return[{id:"b",name:"Бред",category:"Тематика",description:"Доска для обсуждения всего подряд"},{id:"o",name:"Общение",category:"Тематика",description:"Доска для общения"},{id:"soc",name:"Общество",category:"Тематика",description:"Общественные темы"},{id:"media",name:"Медиа",category:"Медиа",description:"Медиа контент"},{id:"a",name:"Аниме",category:"Японская культура",description:"Аниме и манга"},{id:"v",name:"Видеоигры",category:"Развлечения",description:"Видеоигры"},{id:"p",name:"Фото",category:"Творчество",description:"Фотографии"},{id:"s",name:"Программирование",category:"Технологии",description:"Программирование"}]}static processBoardsData(t){const e=[];return t.boards&&Object.keys(t.boards).forEach(o=>{const s=t.boards[o];e.push({id:o,name:s.name||o,category:this.mapCategory(s.category||"Разное"),description:s.description||"",bump_limit:s.bump_limit||500,pages:s.pages||10})}),t.additional_boards&&Object.keys(t.additional_boards).forEach(o=>{const s=t.additional_boards[o];e.push({id:o,name:s.name||o,category:this.mapCategory(s.category||"Разное"),description:s.description||"",bump_limit:s.bump_limit||500,pages:s.pages||10})}),e}static getThreads(t,e=1){return l(this,null,function*(){for(const o of u)try{const s=o==="https://api.allorigins.win/raw?url="?`${o}${encodeURIComponent(`${i}/${t}/${e}.json`)}`:`${o}${encodeURIComponent(`${i}/${t}/${e}.json`)}`,a=yield fetch(s);if(a.ok){const n=yield a.json();return this.processThreadsData(n,t,e)}}catch(s){console.warn(`CORS proxy ${o} failed for threads:`,s);continue}return console.warn("All CORS proxies failed for threads, using fallback data"),this.getFallbackThreads(t,e)})}static getFallbackThreads(t,e){return{threads:[{id:1,title:"Тестовый тред 1",thumbnail:"https://via.placeholder.com/300x200",image_url:"https://via.placeholder.com/800x600",created_at:Date.now()/1e3,posts_count:5,files_count:2,views:100,score:0},{id:2,title:"Тестовый тред 2",thumbnail:"https://via.placeholder.com/300x200",image_url:"https://via.placeholder.com/800x600",created_at:Date.now()/1e3,posts_count:3,files_count:1,views:50,score:0}],page:e,pages:1}}static processThreadsData(t,e,o){const s=[];return t.threads&&t.threads.forEach(a=>{var c;let n=null;if(a.posts&&a.posts.length>0){const r=a.posts[0];r.files&&r.files.length>0&&(n=r.files[0])}s.push({id:a.num,title:a.posts&&a.posts[0]?a.posts[0].subject||((c=a.posts[0].comment)==null?void 0:c.substring(0,100))+"...":"Без названия",thumbnail:n?this.getThumbnailUrl(e,n.name):null,image_url:n?this.getImageUrl(e,n.name):null,created_at:a.date,posts_count:a.posts_count||0,files_count:a.files_count||0,views:a.views||0,score:a.score||0})}),{threads:s,page:o,pages:t.pages||1}}static getThread(t,e){return l(this,null,function*(){for(const o of u)try{const s=o==="https://api.allorigins.win/raw?url="?`${o}${encodeURIComponent(`${i}/${t}/res/${e}.json`)}`:`${o}${encodeURIComponent(`${i}/${t}/res/${e}.json`)}`,a=yield fetch(s);if(a.ok)return yield a.json()}catch(s){console.warn(`CORS proxy ${o} failed for thread:`,s);continue}throw new Error("All CORS proxies failed for thread")})}static mapCategory(t){return{Разное:"Разное",Тематика:"Тематика","Японская культура":"Японская культура",Технологии:"Технологии",Творчество:"Творчество",Развлечения:"Развлечения",Медиа:"Медиа",Политика:"Политика","Взрослый контент":"Взрослый контент",Other:"Разное",Thematic:"Тематика","Japanese Culture":"Японская культура",Technology:"Технологии",Creative:"Творчество",Entertainment:"Развлечения",Media:"Медиа",Politics:"Политика","Adult Content":"Взрослый контент"}[t]||"Разное"}static getImageUrl(t,e){return`${i}/${t}/${e}`}static getThumbnailUrl(t,e){const o=e.replace(/\.[^/.]+$/,""),s=e.split(".").pop();return`${i}/${t}/thumb/${o}_thumb.${s}`}}export{m as BoardsAPI};
