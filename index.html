<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/webapp-tg-imgboard/favicon.ico">
    <!-- Метатеги для iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TG Imgboard">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2678b6">
    <!-- Специфичные для iOS стили -->
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <!-- Фиксация ориентации в портретном режиме -->
    <meta name="screen-orientation" content="portrait">
    <meta name="orientation" content="portrait">
    <link rel="apple-touch-icon" href="/webapp-tg-imgboard/apple-touch-icon.png">
    <link rel="manifest" href="/webapp-tg-imgboard/manifest.json">
    <title>TG Imgboard</title>

    <!-- Загружаем Telegram WebApp скрипт до основного приложения -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Встроенные базовые стили -->
    <style>
      :root {
        --tg-theme-bg-color: #ffffff;
        --tg-theme-text-color: #222222;
        --tg-theme-hint-color: #999999;
        --tg-theme-link-color: #2678b6;
        --tg-theme-button-color: #2678b6;
        --tg-theme-button-text-color: #ffffff;
        --tg-theme-secondary-bg-color: #f5f5f5;
        --safe-area-inset-top: env(safe-area-inset-top, 0px);
        --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
      }
      
      html.dark {
        --tg-theme-bg-color: #212121;
        --tg-theme-text-color: #ffffff;
        --tg-theme-hint-color: #aaaaaa;
        --tg-theme-link-color: #8cc2ff;
        --tg-theme-button-color: #2678b6;
        --tg-theme-button-text-color: #ffffff;
        --tg-theme-secondary-bg-color: #292929;
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      
      html, body {
        height: 100%;
        width: 100%;
        padding: 0;
        margin: 0;
        overflow: hidden;
        /* Блокировка смены ориентации */
        position: fixed;
        overscroll-behavior: none;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: var(--tg-theme-bg-color);
        color: var(--tg-theme-text-color);
        /* Предотвращение прокрутки и полноэкранный режим */
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        -webkit-text-size-adjust: 100%;
        -webkit-font-smoothing: antialiased;
        /* Блокировка свайпа вниз */
        touch-action: pan-x pan-y;
        overscroll-behavior: none;
      }
      
      /* Специфичные стили для iOS в полноэкранном режиме */
      body.ios-fullscreen {
        /* Добавление полей под notch и home indicator */
        padding-top: var(--safe-area-inset-top);
        padding-bottom: var(--safe-area-inset-bottom);
        /* Фиксация размера экрана */
        height: 100vh;
        width: 100vw;
        /* Предотвращение скролла и эффектов scale */
        overflow: hidden;
        -webkit-overflow-scrolling: touch;
      }
      
      #app {
        height: 100%;
        width: 100%;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
        position: relative;
      }
      
      #app-loading {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: var(--tg-theme-bg-color);
        color: var(--tg-theme-text-color);
        transition: opacity 0.3s;
        z-index: 9999;
      }
      
      #app-loading.hidden {
        opacity: 0;
        pointer-events: none;
        z-index: -1;
      }
      
      .spinner {
        width: 40px;
        height: 40px;
        margin-bottom: 20px;
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: var(--tg-theme-button-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      html.dark .spinner {
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-left-color: var(--tg-theme-link-color);
      }
      
      .loading-text {
        font-size: 14px;
        letter-spacing: 1px;
        font-weight: bold;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Стили для базового интерфейса */
      .header {
        background-color: var(--tg-theme-secondary-bg-color);
        padding: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding-top: calc(16px + var(--safe-area-inset-top));
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }
      
      /* Специальные отступы для iOS в полноэкранном режиме */
      body.ios-fullscreen .header {
        padding-top: calc(16px + env(safe-area-inset-top, 20px));
      }
      
      .header h1 {
        font-size: 18px;
        font-weight: bold;
        flex-grow: 1;
        text-align: center;
      }
      
      /* Удаляем стили кнопки назад, так как она больше не нужна */
      
      /* Полноэкранная кнопка */
      .fullscreen-button {
        background: none;
        border: none;
        color: var(--tg-theme-button-color);
        font-size: 18px;
        padding: 8px;
        cursor: pointer;
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        display: flex;
        align-items: center;
        -webkit-appearance: none;
        appearance: none;
      }
      
      /* Специфичные для iOS стили */
      @supports (-webkit-touch-callout: none) {
        .content {
          padding: 0;
          height: calc(100vh - 49px - env(safe-area-inset-top, 0px));
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
          position: relative;
          z-index: 1;
          /* Блокировка свайпа вниз */
          overscroll-behavior: none;
        }
        
        /* Для iOS в полноэкранном режиме */
        body.ios-fullscreen .content {
          height: calc(100vh - 49px - env(safe-area-inset-top, 20px) - env(safe-area-inset-bottom, 20px));
        }
      }
      
      /* Стили для других платформ */
      @supports not (-webkit-touch-callout: none) {
        .content {
          padding: 0;
          height: calc(100% - 49px - var(--safe-area-inset-top));
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
          /* Блокировка свайпа вниз */
          overscroll-behavior: none;
        }
      }
      
      .welcome-text {
        margin-bottom: 24px;
        font-size: 18px;
        text-align: center;
        padding: 20px 16px 0;
      }
      
      /* Стили для секций */
      .section {
        padding: 20px 16px;
        margin-bottom: 1px;
      }
      
      .section-title {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 12px;
        color: var(--tg-theme-text-color);
      }
      
      .section-content {
        background-color: var(--tg-theme-secondary-bg-color);
        border-radius: 12px;
        padding: 16px;
        min-height: 120px;
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }
      
      .section-content p {
        color: var(--tg-theme-hint-color);
        font-size: 14px;
        line-height: 1.5;
      }
    </style>
    <script type="module" crossorigin src="/webapp-tg-imgboard/assets/index-DYOvnCP2.js"></script>
    <link rel="stylesheet" crossorigin href="/webapp-tg-imgboard/assets/index-DcIFoIXr.css">
  </head>
  <body>
    <!-- Базовый экран загрузки -->
    <div id="app-loading">
      <div class="spinner"></div>
      <div class="loading-text">BOARD LOADING...</div>
    </div>
    
    <!-- Базовый интерфейс приложения - будет виден даже без Vue -->
    <div id="basic-app" style="display: none; height: 100%; overflow: hidden;">
      <div class="header">
        <!-- Удаляем кнопку возврата слева сверху -->
        <h1>TG Imgboard</h1>
        <button class="fullscreen-button" id="fullscreen-app">
          <span>⤢</span>
        </button>
      </div>
      
      <div class="content">
        <p class="welcome-text">
          Добро пожаловать в Telegram WebApp!
        </p>
        
        <!-- Три прокручиваемые секции -->
        <div class="section">
          <div class="section-title">Секция 1</div>
          <div class="section-content">
            <p>Это первая секция вашего приложения. Здесь может быть размещен любой контент, такой как изображения, текст или интерактивные элементы.</p>
          </div>
        </div>
        
        <div class="section">
          <div class="section-title">Секция 2</div>
          <div class="section-content">
            <p>Вторая секция для другого контента. Вы можете добавить здесь свой специфический контент или функциональность для вашего приложения.</p>
          </div>
        </div>
        
        <div class="section">
          <div class="section-title">Секция 3</div>
          <div class="section-content">
            <p>Третья секция завершает интерфейс. Это прокручиваемая панель, и вы можете добавить сколько угодно секций.</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Контейнер для Vue приложения -->
    <div id="app" style="display: none;"></div>

    <script>
      // Определяем iOS устройства
      var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      
      // Базовая проверка наличия Telegram WebApp API
      window.addEventListener('DOMContentLoaded', function() {
        // Элементы страницы
        var appLoading = document.getElementById('app-loading');
        var basicApp = document.getElementById('basic-app');
        var vueApp = document.getElementById('app');
        var isAppHidden = false;
        
        // Блокировка свайпа вниз
        document.addEventListener('touchstart', function(e) {
          if (e.touches.length > 1) {
            e.preventDefault();
          }
        }, { passive: false });
        
        // Блокировка смены ориентации
        window.addEventListener('orientationchange', function(e) {
          if (window.orientation !== 0 && window.orientation !== undefined) {
            // Попытка вернуться к портретной ориентации
            try {
              window.screen.orientation.lock('portrait');
            } catch (err) {
              console.error('Ошибка блокировки ориентации:', err);
            }
          }
        });
        
        // Попытка заблокировать ориентацию в портретном режиме
        try {
          if (window.screen && window.screen.orientation) {
            window.screen.orientation.lock('portrait').catch(function(err) {
              console.error('Ошибка блокировки ориентации:', err);
            });
          }
        } catch (err) {
          console.error('Ошибка блокировки ориентации:', err);
        }
        
        // Настраиваем для iOS
        if (isIOS) {
          document.body.classList.add('ios');
          document.body.classList.add('ios-fullscreen');
          
          // Блокировка свайпа вниз на iOS
          document.addEventListener('touchmove', function(event) {
            // Определяем направление движения
            if (event.touches && event.touches.length && event.touches[0].clientY < 0) {
              event.preventDefault();
            }
            
            // Разрешаем скроллинг только внутри элементов с классом content
            if (!event.target.closest('.content')) {
              event.preventDefault();
            }
          }, { passive: false });
        }
        
        // Инициализация Telegram API
        var tg = null;
        if (window.Telegram && window.Telegram.WebApp) {
          tg = window.Telegram.WebApp;
          
          // Применяем темную тему если нужно
          if (tg.colorScheme === 'dark') {
            document.documentElement.classList.add('dark');
          }
          
          // Настройка переменных CSS на основе Telegram темы
          if (tg.themeParams) {
            document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color);
            document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color);
            document.documentElement.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color);
            document.documentElement.style.setProperty('--tg-theme-link-color', tg.themeParams.link_color);
            document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color);
            document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color);
            document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', tg.themeParams.secondary_bg_color);
          }
          
          // Удаляем обработчик для кнопки закрытия, так как мы удалили эту кнопку
          
          // Обработчик для кнопки полного экрана
          var fullscreenButton = document.getElementById('fullscreen-app');
          if (fullscreenButton) {
            // Функция переключения полноэкранного режима
            var toggleFullScreen = function() {
              try {
                if (isIOS) {
                  // Специальный подход для iOS
                  document.body.classList.toggle('ios-fullscreen');
                  
                  // Используем несколько методов для полноэкранного режима на iOS
                  if (tg.isExpanded) {
                    // Если метод requestFullscreen доступен
                    if (typeof tg.requestFullscreen === 'function') {
                      tg.requestFullscreen();
                    }
                  }
                  
                  // В любом случае используем expand для iOS
                  if (typeof tg.expand === 'function') {
                    tg.expand();
                  }
                  
                  // Дополнительно для iOS устанавливаем специфичные стили
                  setTimeout(function() {
                    // Устанавливаем viewport на полный размер
                    var viewportMeta = document.querySelector('meta[name="viewport"]');
                    if (viewportMeta) {
                      viewportMeta.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, minimal-ui');
                    }
                    
                    // Обновляем скролл в контентной области
                    var content = document.querySelector('.content');
                    if (content) {
                      content.style.overflow = 'hidden';
                      setTimeout(function() {
                        content.style.overflow = 'auto';
                      }, 50);
                    }
                  }, 100);
                } else {
                  // Для других платформ используем стандартный подход
                  if (tg && typeof tg.requestFullscreen === 'function') {
                    tg.requestFullscreen();
                  } else if (tg && typeof tg.expand === 'function') {
                    // Если requestFullscreen не доступен, используем expand как запасной вариант
                    tg.expand();
                  }
                }
              } catch (e) {
                console.error('Ошибка при переключении полноэкранного режима:', e);
              }
            };
            
            // Добавляем обработчики событий
            fullscreenButton.addEventListener('click', toggleFullScreen);
            
            if (isIOS) {
              fullscreenButton.addEventListener('touchstart', function() {
                this.style.opacity = '0.7';
              });
              fullscreenButton.addEventListener('touchend', function() {
                this.style.opacity = '1';
                toggleFullScreen();
              });
            }
          }
          
          // Автоматическая активация полноэкранного режима сразу при загрузке
          setTimeout(function() {
            try {
              // Эмулируем клик по кнопке "⤢" для активации полноэкранного режима
              if (fullscreenButton) {
                fullscreenButton.click();
              }
              
              if (isIOS) {
                // Для iOS добавляем класс ios-fullscreen для стилизации
                document.body.classList.add('ios-fullscreen');
                
                // Комбинация методов для обеспечения полноэкранного режима на iOS
                if (typeof tg.expand === 'function') {
                  tg.expand();
                }
                
                // На iOS дополнительно пробуем requestFullscreen если доступен
                if (typeof tg.requestFullscreen === 'function') {
                  tg.requestFullscreen();
                }
                
                // Делаем более длинную задержку для iOS
                setTimeout(function() {
                  // Пробуем еще раз для надежности
                  if (typeof tg.expand === 'function') {
                    tg.expand();
                  }
                  
                  // Пробуем еще методы на iOS
                  try {
                    // Имитация эффекта полного экрана
                    document.documentElement.style.height = '100%';
                    document.body.style.height = '100%';
                    document.body.style.position = 'fixed';
                    document.body.style.top = '0';
                    document.body.style.left = '0';
                    document.body.style.width = '100%';
                  } catch (e) {
                    console.error('Ошибка при настройке стилей полного экрана:', e);
                  }
                }, 1500);
              } else {
                // Для других платформ
                if (tg && typeof tg.requestFullscreen === 'function') {
                  tg.requestFullscreen();
                } else if (tg && typeof tg.expand === 'function') {
                  tg.expand();
                }
              }
            } catch (e) {
              console.error('Ошибка при активации полноэкранного режима:', e);
            }
          }, isIOS ? 500 : 300);
        }
        
        // Функция скрытия экрана загрузки
        window.hideLoading = function() {
          if (isAppHidden) return; // Предотвращаем повторное скрытие
          isAppHidden = true;
          
          // Скрываем экран загрузки
          appLoading.classList.add('hidden');
          
          // Показываем базовый интерфейс
          basicApp.style.display = 'block';
          
          try {
            // Пытаемся монтировать Vue приложение с задержкой
            setTimeout(function() {
              vueApp.style.display = 'block';
              
              // iOS-специфичная подстройка скролла
              if (isIOS) {
                // Иногда для iOS требуется принудительно обновить область прокрутки
                var content = document.querySelector('.content');
                if (content) {
                  content.style.overflow = 'hidden';
                  setTimeout(function() {
                    content.style.overflow = 'auto';
                  }, 50);
                }
              }
              
              // Полностью удаляем экран загрузки после анимации
              setTimeout(function() {
                if (appLoading.parentNode) {
                  appLoading.parentNode.removeChild(appLoading);
                }
              }, 300);
            }, 100);
          } catch (e) {
            console.error('Ошибка при инициализации Vue:', e);
          }
        };
        
        // Инициализация Telegram WebApp и автоматическое скрытие экрана загрузки
        setTimeout(function() {
          if (window.Telegram && window.Telegram.WebApp) {
            try {
              // Сообщаем Telegram что приложение готово
              window.Telegram.WebApp.ready();
              window.Telegram.WebApp.expand();
              
              // Принудительно устанавливаем полноэкранный режим
              document.documentElement.style.height = '100%';
              document.body.style.height = '100%';
            } catch (e) {
              console.error('Ошибка при инициализации Telegram WebApp:', e);
            }
          }
          
          // ВАЖНО: Принудительно скрываем экран загрузки через 1 секунду
          // Для iOS делаем немного дольше
          setTimeout(function() {
            window.hideLoading();
          }, isIOS ? 1000 : 500);
        }, 100);
        
        // Дополнительная защита: скрываем экран загрузки при загрузке страницы
        window.addEventListener('load', function() {
          setTimeout(function() {
            window.hideLoading();
          }, 500);
        });
      });
    </script>
    
    <!-- Vue приложение (загружается отложенно) -->
  </body>
</html>
