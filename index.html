<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>TG Imgboard</title>
  <link rel="icon" href="/webapp-tg-imgboard/favicon.ico">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--bg:#fff;--text:#222;--hint:#999;--link:#2678b6;--btn-bg:#2678b6;--btn-text:#fff;--sec-bg:#f5f5f5}
    html.dark{--bg:#212121;--text:#fff;--hint:#aaa;--link:#8cc2ff;--sec-bg:#292929}
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{width:100%;height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text)}
    body.ios-full{padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom);height:100vh;overflow:hidden}
    #app-loading{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--bg);color:var(--text);z-index:9999;transition:opacity .3s}
    #app-loading.hidden{opacity:0;pointer-events:none;z-index:-1}
    .spinner{width:40px;height:40px;border:4px solid rgba(0,0,0,.1);border-left-color:var(--btn-bg);border-radius:50%;animation:spin 1s linear infinite}
    html.dark .spinner{border:4px solid rgba(255,255,255,.1);border-left-color:var(--link)}
    .loading-text{margin-top:20px;font:bold 14px/1 Arial, sans-serif;letter-spacing:1px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .header{background:var(--sec-bg);padding:calc(16px + env(safe-area-inset-top)) 16px;display:flex;align-items:center;justify-content:center;position:relative;backdrop-filter:blur(10px)}
    .header h1{font:18px/1 Arial,sans-serif;font-weight:bold}
    .fullscreen-btn{position:absolute;right:16px;background:none;border:none;color:var(--link);font-size:18px;cursor:pointer}
    .content{overflow:auto;height:calc(100% - 49px - env(safe-area-inset-top));-webkit-overflow-scrolling:touch}
    .section{padding:16px;margin-bottom:1px}
    .section-title{font:16px/1 Arial,sans-serif;font-weight:bold;margin-bottom:8px}
    .section-content{background:var(--sec-bg);border-radius:12px;padding:12px}
    .board-link{display:block;padding:6px 0;color:var(--link);text-decoration:none;font-size:14px}
  </style>
</head>
<body>
  <div id="app-loading"><div class="spinner"></div><div class="loading-text">Загрузка досок...</div></div>
  <div id="basic-app" style="display:none"><div class="header"><h1>TG Imgboard</h1><button class="fullscreen-btn" id="fs-btn">⤢</button></div><div class="content" id="board-container"></div></div>
  <script>
    const tg=window.Telegram?.WebApp;const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
    if(isIOS)document.body.classList.add('ios');
    tg?.onEvent('themeChanged',()=>document.documentElement.classList.toggle('dark',tg.colorScheme=='dark'));
    document.getElementById('fs-btn')?.addEventListener('click',()=>tg?.expand());
    async function init(){
      const order=['Тематика','Творчество','Политика и новости','Техника и софт','Игры','Взрослым','Японская культура','Разное'];
      const res=await fetch('https://2ch.hk/api/mobile/v2/boards');
      const data=await res.json();
      const boards=data.boards||[];
      const container=document.getElementById('board-container');
      order.forEach(cat=>{
        const list=boards.filter(b=>b.category==cat);
        if(list.length)container.append(createSection(cat,list));
      });
      const newList=boards.filter(b=>b.is_new);
      if(newList.length)container.append(createSection('Новые доски',newList));
      document.getElementById('app-loading').classList.add('hidden');
      document.getElementById('basic-app').style.display='block';
      tg?.ready();tg?.expand();
    }
    function createSection(title,boards){
      const sec=document.createElement('div');sec.className='section';
      sec.innerHTML=`<div class="section-title">${title}</div><div class="section-content">${boards.map(b=>`<a href="#" class="board-link" data-board="${b.name}">${b.title||b.name}</a>`).join('')}</div>`;
      return sec;
    }
    window.addEventListener('load',init);
  </script>
</body>
</html>
